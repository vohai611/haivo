<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Retrieve university entrance exam score | Hai&#39;s blog</title>
<meta name="keywords" content="API, httr" />
<meta name="description" content="University entrance exam is one of the most important exam of every Vietnamese student. This post present how to use R to send API request to retrieve full exam score in the whole country in 2021. The full script and data could be found at my github repository.
How does it work There are several website provide web interface to get the score. In my script, I use two sources of data: https://diemthi.">
<meta name="author" content="Hai Vo">
<link rel="canonical" href="https://haivo.netlify.app/project/2021-08-06-diem-thi-thpt/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.35cd0f65a15cafa92372b8313deef5960aae04b90ad722f2bbf509eb0468137e.css" integrity="sha256-Nc0PZaFcr6kjcrgxPe71lgquBLkK1yLyu/UJ6wRoE34=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://haivo.netlify.app/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://haivo.netlify.app/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://haivo.netlify.app/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://haivo.netlify.app/apple-touch-icon.png">
<link rel="mask-icon" href="https://haivo.netlify.app/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.86.1" />
<meta property="og:title" content="Retrieve university entrance exam score" />
<meta property="og:description" content="University entrance exam is one of the most important exam of every Vietnamese student. This post present how to use R to send API request to retrieve full exam score in the whole country in 2021. The full script and data could be found at my github repository.
How does it work There are several website provide web interface to get the score. In my script, I use two sources of data: https://diemthi." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://haivo.netlify.app/project/2021-08-06-diem-thi-thpt/" /><meta property="article:section" content="project" />
<meta property="article:published_time" content="2021-08-06T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-08-06T00:00:00&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Retrieve university entrance exam score"/>
<meta name="twitter:description" content="University entrance exam is one of the most important exam of every Vietnamese student. This post present how to use R to send API request to retrieve full exam score in the whole country in 2021. The full script and data could be found at my github repository.
How does it work There are several website provide web interface to get the score. In my script, I use two sources of data: https://diemthi."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Projects",
      "item": "https://haivo.netlify.app/project/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Retrieve university entrance exam score",
      "item": "https://haivo.netlify.app/project/2021-08-06-diem-thi-thpt/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Retrieve university entrance exam score",
  "name": "Retrieve university entrance exam score",
  "description": "University entrance exam is one of the most important exam of every Vietnamese student. This post present how to use R to send API request to retrieve full exam score in the whole country in 2021. The full script and data could be found at my github repository.\nHow does it work There are several website provide web interface to get the score. In my script, I use two sources of data: https://diemthi.",
  "keywords": [
    "API", "httr"
  ],
  "articleBody": "University entrance exam is one of the most important exam of every Vietnamese student. This post present how to use R to send API request to retrieve full exam score in the whole country in 2021. The full script and data could be found at my github repository.\nHow does it work There are several website provide web interface to get the score. In my script, I use two sources of data: https://diemthi.vnanet.vn and https://tienphong.vn/tra-cuu-diem-thi.tpo.\nUnder the hood, these two website use API to retrieve the data, and user can access this API request directly via web browser devtools (network tab). The API from vnanet.vn is quite slow and only allow to retrieve 1 result per request. On the other hand, tienphong.vn allows user to get a maximum of 300 result per request, hence I decide to use the latter options to get the whole data.\nThese two API take the student ID as input and provide full result of that student as output. Input are in the form {province_code}{student_id}. Province_code vary from 01 to 64, while the student_id are from 1 to the max number of student attend in the exam. For example, input = ‘01000001’ is for student 1 from the province that had code 01 (Ha Noi).\nDemonstration Option 1:\nlibrary(tidyverse) library(glue) library(httr) library(here) get_score  function(sbd) { url  glue(\"https://diemthi.vnanet.vn/Home/SearchBySobaodanh?code={ sbd }\u0026nam=2021\") GET(url) %% content(type = 'text', encoding = 'UTF-8') %% jsonlite::fromJSON() %% .[['result']] %% as_tibble() } get_score('01000001') %% knitr::kable()    CityCode CityArea Code Toan NguVan NgoaiNgu VatLi HoaHoc SinhHoc KHTN DiaLi LichSu GDCD KHXH ResultGroup Result     01 NA 01000001 2.20 3.50      5.50 2.50   [{“g”:“A07”,“p”:10.20},{“g”:“C00”,“p”:11.50},{“g”:“C03”,“p”:8.20},{“g”:“C04”,“p”:11.20}]     Option 2: In this API options, I can use sbd = ‘0100001’ to get the result of 10 attendance in one request from 01000011 to 01000019\nget_score2  function(sbd){ # prepare URL url  glue('https://tienphong.vn/api/diemthi/get/result?type=0\u0026keyword={ sbd }\u0026kythi=THPT\u0026nam=2021\u0026cumthi=0') ## send request a  GET(url, add_headers('referer'= 'https://tienphong.vn/tra-cuu-diem-thi.tpo') ) %% content(as = 'text') %% jsonlite::fromJSON() # parse request to text format a$data$results %% rvest::read_html() %% rvest::html_text2() %% return() } # data received in the form of TSV: get_score2('0100001') %% data.table::fread() %% knitr::kable()    V1 V2 V3 V4 V5 V6 V7 V8 V9 V10 V11 V12     1 1000019 7.0 8.50 8.8 NA NA NA 4.00 5.25 6.75 NA   2 1000018 8.8 8.25 NA 8.00 5.00 6.75 NA NA NA NA   3 1000017 7.8 8.00 9.6 7.50 8.00 7.25 NA NA NA NA   4 1000016 7.8 8.50 9.4 NA NA NA 6.50 7.50 8.00 NA   5 1000015 6.0 7.75 9.0 NA NA NA 4.00 7.75 7.00 NA   6 1000014 7.4 8.00 8.6 NA NA NA 6.00 6.25 7.50 NA   7 1000013 7.4 6.75 9.0 NA NA NA 3.75 8.50 6.50 NA   8 1000012 6.4 6.75 7.8 NA NA NA 5.50 7.00 7.50 NA   9 1000011 6.0 7.75 8.2 NA NA NA 3.00 7.25 8.50 NA   10 1000010 8.8 6.25 9.2 8.75 8.75 3.00 NA NA NA NA    In the script, I also exploit multi-core in my machine (4-cores) to send multiple request simultaneously by using furrr package (front-end to the future package). The use of parallel code yield around 3 times faster result (60 mins for nearly 1 millions result) compare with normal use.\nBecause the API sent me the province code instead of province name, I will need an extra step to get the province.\nlibrary(rvest) province_code  read_html(\"https://diemthi.vnanet.vn/Home/\") %% html_elements(\"#listCity\") %% html_text2() %% str_replace_all(pattern = \"(\\\\d{2})\", \"\\n\\\\1, \") %% read_csv(skip = 1, col_names = c('province_code', 'province')) %% mutate(province = stringi::stri_trans_general(province, \"Latin-ASCII\")) %% mutate(province = str_remove(province, 'So GDDT '), province = str_remove(province, \"So GD KHCN \")) province_code ## # A tibble: 64 × 2 ## province_code province ##   ## 1 01 Ha Noi ## 2 02 TP. Ho Chi Minh ## 3 03 Hai Phong ## 4 04 Da Nang ## 5 05 Ha Giang ## 6 06 Cao Bang ## 7 07 Lai Chau ## 8 08 Lao Cai ## 9 09 Tuyen Quang ## 10 10 Lang Son ## # … with 54 more rows Finally I just need to join to data sets, this is what final result look like:\nhere::i_am(\"content/project/2021-08-06-diem-thi-thpt/index.markdown\") path  \"content/project/2021-08-06-diem-thi-thpt\" data  read_rds(here(path, \"data/output.rds\")) data %% left_join(province_code) %% head(10) %% knitr::kable()    province_code V2 toan van nn li hoa sinh su dia gdcd province     01 1000099 7.8 7.75 7.2 NA NA NA 2.75 6.50 7.50 Ha Noi   01 1000098 9.4 7.50 8.4 8.75 8.0 4.75 NA NA NA Ha Noi   01 1000097 3.8 8.25 6.8 NA NA NA 4.75 6.75 9.00 Ha Noi   01 1000096 5.8 8.00 9.2 NA NA NA 4.25 7.00 7.25 Ha Noi   01 1000095 5.2 6.00 2.6 NA NA NA 7.50 8.00 8.50 Ha Noi   01 1000094 3.8 7.00 4.2 NA NA NA 3.75 7.25 7.50 Ha Noi   01 1000093 9.4 7.50 NA 8.50 5.5 6.75 NA NA NA Ha Noi   01 1000092 6.2 7.75 4.0 NA NA NA 3.75 8.00 8.25 Ha Noi   01 1000091 6.0 6.50 3.8 NA NA NA 4.50 6.00 8.00 Ha Noi   01 1000090 8.4 8.00 9.2 NA NA NA 6.25 8.50 8.50 Ha Noi    ",
  "wordCount" : "835",
  "inLanguage": "en",
  "datePublished": "2021-08-06T00:00:00Z",
  "dateModified": "2021-08-06T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Hai Vo"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://haivo.netlify.app/project/2021-08-06-diem-thi-thpt/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Hai's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://haivo.netlify.app/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://haivo.netlify.app" accesskey="h" title="Hai&#39;s blog (Alt + H)">Hai&#39;s blog</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://haivo.netlify.app/post" title="Post">
                    <span>Post</span>
                </a>
            </li>
            <li>
                <a href="https://haivo.netlify.app/project" title="Project">
                    <span>Project</span>
                </a>
            </li>
            <li>
                <a href="https://haivo.netlify.app/static/pdf/cv.pdf" title="Resume">
                    <span>Resume</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/vohai611" title="Github">
                    <span>Github</span>
                </a>
            </li>
            <li>
                <a href="mailto:hai835559@gmail.com" title="Email">
                    <span>Email</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://haivo.netlify.app">Home</a>&nbsp;»&nbsp;<a href="https://haivo.netlify.app/project/">Projects</a></div>
    <h1 class="post-title">
      Retrieve university entrance exam score
    </h1>
    <div class="post-meta">August 6, 2021&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Hai Vo
</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <div class="details">Table of Contents</div>
        </summary>
        <div class="inner"><ul>
                <li>
                    <a href="#how-does-it-work" aria-label="How does it work">How does it work</a></li>
                <li>
                    <a href="#demonstration" aria-label="Demonstration">Demonstration</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>University entrance exam is one of the most important exam of every Vietnamese student. This post present how to use R to send API request to retrieve full exam score in the whole country in 2021. The full script and data could be found at my github <a href="https://github.com/vohai611/diemthi-thpt-2021">repository</a>.</p>
<h1 id="how-does-it-work">How does it work<a hidden class="anchor" aria-hidden="true" href="#how-does-it-work">#</a></h1>
<p>There are several website provide web interface to get the score. In my script, I use two sources of data:
<a href="https://diemthi.vnanet.vn">https://diemthi.vnanet.vn</a> and <a href="https://tienphong.vn/tra-cuu-diem-thi.tpo">https://tienphong.vn/tra-cuu-diem-thi.tpo</a>.</p>
<p>Under the hood, these two website use API to retrieve the data, and user can access this API request directly via web browser devtools (network tab). The API from vnanet.vn is quite slow and only allow to retrieve 1 result per request. On the other hand, tienphong.vn allows user to get a maximum of 300 result per request, hence I decide to use the latter options to get the whole data.</p>
<p>These two API take the student ID as input and provide full result of that student as output. Input are in the form {province_code}{student_id}. Province_code vary from 01 to 64, while the student_id are from 1 to the max number of student attend in the exam. For example, input = &lsquo;01000001&rsquo; is for student 1 from the province that had code 01 (Ha Noi).</p>
<h1 id="demonstration">Demonstration<a hidden class="anchor" aria-hidden="true" href="#demonstration">#</a></h1>
<p>Option 1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(tidyverse)
<span style="color:#a6e22e">library</span>(glue)
<span style="color:#a6e22e">library</span>(httr)
<span style="color:#a6e22e">library</span>(here)
get_score <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(sbd) {
  url <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">glue</span>(<span style="color:#e6db74">&#34;https://diemthi.vnanet.vn/Home/SearchBySobaodanh?code={ sbd }&amp;nam=2021&#34;</span>)
  <span style="color:#a6e22e">GET</span>(url) <span style="color:#f92672">%&gt;%</span> 
    <span style="color:#a6e22e">content</span>(type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;text&#39;</span>, encoding <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;UTF-8&#39;</span>) <span style="color:#f92672">%&gt;%</span> 
    jsonlite<span style="color:#f92672">::</span><span style="color:#a6e22e">fromJSON</span>() <span style="color:#f92672">%&gt;%</span> 
    .[[<span style="color:#e6db74">&#39;result&#39;</span>]] <span style="color:#f92672">%&gt;%</span> 
    <span style="color:#a6e22e">as_tibble</span>()
}

<span style="color:#a6e22e">get_score</span>(<span style="color:#e6db74">&#39;01000001&#39;</span>) <span style="color:#f92672">%&gt;%</span> 
  knitr<span style="color:#f92672">::</span><span style="color:#a6e22e">kable</span>()
</code></pre></div><table>
<thead>
<tr>
<th style="text-align:left">CityCode</th>
<th style="text-align:left">CityArea</th>
<th style="text-align:left">Code</th>
<th style="text-align:left">Toan</th>
<th style="text-align:left">NguVan</th>
<th style="text-align:left">NgoaiNgu</th>
<th style="text-align:left">VatLi</th>
<th style="text-align:left">HoaHoc</th>
<th style="text-align:left">SinhHoc</th>
<th style="text-align:left">KHTN</th>
<th style="text-align:left">DiaLi</th>
<th style="text-align:left">LichSu</th>
<th style="text-align:left">GDCD</th>
<th style="text-align:left">KHXH</th>
<th style="text-align:left">ResultGroup</th>
<th style="text-align:left">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">01</td>
<td style="text-align:left">NA</td>
<td style="text-align:left">01000001</td>
<td style="text-align:left">2.20</td>
<td style="text-align:left">3.50</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">5.50</td>
<td style="text-align:left">2.50</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">[{&ldquo;g&rdquo;:&ldquo;A07&rdquo;,&ldquo;p&rdquo;:10.20},{&ldquo;g&rdquo;:&ldquo;C00&rdquo;,&ldquo;p&rdquo;:11.50},{&ldquo;g&rdquo;:&ldquo;C03&rdquo;,&ldquo;p&rdquo;:8.20},{&ldquo;g&rdquo;:&ldquo;C04&rdquo;,&ldquo;p&rdquo;:11.20}]</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<p>Option 2:
In this API options, I can use sbd = &lsquo;0100001&rsquo; to get the result of 10 attendance in one request from 01000011 to 01000019</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">get_score2 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(sbd){
  
  <span style="color:#75715e"># prepare URL</span>
  url <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">glue</span>(<span style="color:#e6db74">&#39;https://tienphong.vn/api/diemthi/get/result?type=0&amp;keyword={ sbd }&amp;kythi=THPT&amp;nam=2021&amp;cumthi=0&#39;</span>)
  <span style="color:#75715e">## send request</span>
  a <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">GET</span>(url,
           <span style="color:#a6e22e">add_headers</span>(<span style="color:#e6db74">&#39;referer&#39;</span><span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;https://tienphong.vn/tra-cuu-diem-thi.tpo&#39;</span>)
  ) <span style="color:#f92672">%&gt;%</span> 
    <span style="color:#a6e22e">content</span>(as <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;text&#39;</span>) <span style="color:#f92672">%&gt;%</span> 
    jsonlite<span style="color:#f92672">::</span><span style="color:#a6e22e">fromJSON</span>()
  
  <span style="color:#75715e"># parse request to text format</span>
  a<span style="color:#f92672">$</span>data<span style="color:#f92672">$</span>results <span style="color:#f92672">%&gt;%</span> 
    rvest<span style="color:#f92672">::</span><span style="color:#a6e22e">read_html</span>() <span style="color:#f92672">%&gt;%</span> 
    rvest<span style="color:#f92672">::</span><span style="color:#a6e22e">html_text2</span>() <span style="color:#f92672">%&gt;%</span> 
    <span style="color:#a6e22e">return</span>()
}

<span style="color:#75715e"># data received in the form of TSV:</span>
<span style="color:#a6e22e">get_score2</span>(<span style="color:#e6db74">&#39;0100001&#39;</span>) <span style="color:#f92672">%&gt;%</span> 
  data.table<span style="color:#f92672">::</span><span style="color:#a6e22e">fread</span>() <span style="color:#f92672">%&gt;%</span> 
  knitr<span style="color:#f92672">::</span><span style="color:#a6e22e">kable</span>()
</code></pre></div><table>
<thead>
<tr>
<th style="text-align:right">V1</th>
<th style="text-align:right">V2</th>
<th style="text-align:right">V3</th>
<th style="text-align:right">V4</th>
<th style="text-align:right">V5</th>
<th style="text-align:right">V6</th>
<th style="text-align:right">V7</th>
<th style="text-align:right">V8</th>
<th style="text-align:right">V9</th>
<th style="text-align:right">V10</th>
<th style="text-align:right">V11</th>
<th style="text-align:left">V12</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1000019</td>
<td style="text-align:right">7.0</td>
<td style="text-align:right">8.50</td>
<td style="text-align:right">8.8</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">4.00</td>
<td style="text-align:right">5.25</td>
<td style="text-align:right">6.75</td>
<td style="text-align:left">NA</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">1000018</td>
<td style="text-align:right">8.8</td>
<td style="text-align:right">8.25</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">8.00</td>
<td style="text-align:right">5.00</td>
<td style="text-align:right">6.75</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:left">NA</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">1000017</td>
<td style="text-align:right">7.8</td>
<td style="text-align:right">8.00</td>
<td style="text-align:right">9.6</td>
<td style="text-align:right">7.50</td>
<td style="text-align:right">8.00</td>
<td style="text-align:right">7.25</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:left">NA</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">1000016</td>
<td style="text-align:right">7.8</td>
<td style="text-align:right">8.50</td>
<td style="text-align:right">9.4</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">6.50</td>
<td style="text-align:right">7.50</td>
<td style="text-align:right">8.00</td>
<td style="text-align:left">NA</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:right">1000015</td>
<td style="text-align:right">6.0</td>
<td style="text-align:right">7.75</td>
<td style="text-align:right">9.0</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">4.00</td>
<td style="text-align:right">7.75</td>
<td style="text-align:right">7.00</td>
<td style="text-align:left">NA</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:right">1000014</td>
<td style="text-align:right">7.4</td>
<td style="text-align:right">8.00</td>
<td style="text-align:right">8.6</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">6.00</td>
<td style="text-align:right">6.25</td>
<td style="text-align:right">7.50</td>
<td style="text-align:left">NA</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:right">1000013</td>
<td style="text-align:right">7.4</td>
<td style="text-align:right">6.75</td>
<td style="text-align:right">9.0</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">3.75</td>
<td style="text-align:right">8.50</td>
<td style="text-align:right">6.50</td>
<td style="text-align:left">NA</td>
</tr>
<tr>
<td style="text-align:right">8</td>
<td style="text-align:right">1000012</td>
<td style="text-align:right">6.4</td>
<td style="text-align:right">6.75</td>
<td style="text-align:right">7.8</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">5.50</td>
<td style="text-align:right">7.00</td>
<td style="text-align:right">7.50</td>
<td style="text-align:left">NA</td>
</tr>
<tr>
<td style="text-align:right">9</td>
<td style="text-align:right">1000011</td>
<td style="text-align:right">6.0</td>
<td style="text-align:right">7.75</td>
<td style="text-align:right">8.2</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">3.00</td>
<td style="text-align:right">7.25</td>
<td style="text-align:right">8.50</td>
<td style="text-align:left">NA</td>
</tr>
<tr>
<td style="text-align:right">10</td>
<td style="text-align:right">1000010</td>
<td style="text-align:right">8.8</td>
<td style="text-align:right">6.25</td>
<td style="text-align:right">9.2</td>
<td style="text-align:right">8.75</td>
<td style="text-align:right">8.75</td>
<td style="text-align:right">3.00</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:left">NA</td>
</tr>
</tbody>
</table>
<p>In the script, I also exploit multi-core in my machine (4-cores) to send multiple request simultaneously by using <code>furrr</code> package (front-end to the <code>future</code> package). The use of parallel code yield around 3 times faster result (60 mins for nearly 1 millions result) compare with normal use.</p>
<p>Because the API sent me the province code instead of province name, I will need an extra step to get the province.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(rvest)
province_code <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read_html</span>(<span style="color:#e6db74">&#34;https://diemthi.vnanet.vn/Home/&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">html_elements</span>(<span style="color:#e6db74">&#34;#listCity&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">html_text2</span>() <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">str_replace_all</span>(pattern <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;(\\d{2})&#34;</span>, <span style="color:#e6db74">&#34;\n\\1, &#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">read_csv</span>(skip <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, col_names <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#39;province_code&#39;</span>, <span style="color:#e6db74">&#39;province&#39;</span>)) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">mutate</span>(province <span style="color:#f92672">=</span> stringi<span style="color:#f92672">::</span><span style="color:#a6e22e">stri_trans_general</span>(province, <span style="color:#e6db74">&#34;Latin-ASCII&#34;</span>)) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">mutate</span>(province <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_remove</span>(province, <span style="color:#e6db74">&#39;So GDDT &#39;</span>),
         province <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_remove</span>(province, <span style="color:#e6db74">&#34;So GD KHCN &#34;</span>))

province_code
</code></pre></div><pre><code>## # A tibble: 64 × 2
##    province_code province       
##    &lt;chr&gt;         &lt;chr&gt;          
##  1 01            Ha Noi         
##  2 02            TP. Ho Chi Minh
##  3 03            Hai Phong      
##  4 04            Da Nang        
##  5 05            Ha Giang       
##  6 06            Cao Bang       
##  7 07            Lai Chau       
##  8 08            Lao Cai        
##  9 09            Tuyen Quang    
## 10 10            Lang Son       
## # … with 54 more rows
</code></pre><p>Finally I just need to join to data sets, this is what final result look like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">here<span style="color:#f92672">::</span><span style="color:#a6e22e">i_am</span>(<span style="color:#e6db74">&#34;content/project/2021-08-06-diem-thi-thpt/index.markdown&#34;</span>)
path <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;content/project/2021-08-06-diem-thi-thpt&#34;</span>

data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read_rds</span>(<span style="color:#a6e22e">here</span>(path, <span style="color:#e6db74">&#34;data/output.rds&#34;</span>))

data <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">left_join</span>(province_code) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">head</span>(<span style="color:#ae81ff">10</span>) <span style="color:#f92672">%&gt;%</span> 
  knitr<span style="color:#f92672">::</span><span style="color:#a6e22e">kable</span>()
</code></pre></div><table>
<thead>
<tr>
<th style="text-align:left">province_code</th>
<th style="text-align:right">V2</th>
<th style="text-align:right">toan</th>
<th style="text-align:right">van</th>
<th style="text-align:right">nn</th>
<th style="text-align:right">li</th>
<th style="text-align:right">hoa</th>
<th style="text-align:right">sinh</th>
<th style="text-align:right">su</th>
<th style="text-align:right">dia</th>
<th style="text-align:right">gdcd</th>
<th style="text-align:left">province</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">01</td>
<td style="text-align:right">1000099</td>
<td style="text-align:right">7.8</td>
<td style="text-align:right">7.75</td>
<td style="text-align:right">7.2</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">2.75</td>
<td style="text-align:right">6.50</td>
<td style="text-align:right">7.50</td>
<td style="text-align:left">Ha Noi</td>
</tr>
<tr>
<td style="text-align:left">01</td>
<td style="text-align:right">1000098</td>
<td style="text-align:right">9.4</td>
<td style="text-align:right">7.50</td>
<td style="text-align:right">8.4</td>
<td style="text-align:right">8.75</td>
<td style="text-align:right">8.0</td>
<td style="text-align:right">4.75</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:left">Ha Noi</td>
</tr>
<tr>
<td style="text-align:left">01</td>
<td style="text-align:right">1000097</td>
<td style="text-align:right">3.8</td>
<td style="text-align:right">8.25</td>
<td style="text-align:right">6.8</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">4.75</td>
<td style="text-align:right">6.75</td>
<td style="text-align:right">9.00</td>
<td style="text-align:left">Ha Noi</td>
</tr>
<tr>
<td style="text-align:left">01</td>
<td style="text-align:right">1000096</td>
<td style="text-align:right">5.8</td>
<td style="text-align:right">8.00</td>
<td style="text-align:right">9.2</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">4.25</td>
<td style="text-align:right">7.00</td>
<td style="text-align:right">7.25</td>
<td style="text-align:left">Ha Noi</td>
</tr>
<tr>
<td style="text-align:left">01</td>
<td style="text-align:right">1000095</td>
<td style="text-align:right">5.2</td>
<td style="text-align:right">6.00</td>
<td style="text-align:right">2.6</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">7.50</td>
<td style="text-align:right">8.00</td>
<td style="text-align:right">8.50</td>
<td style="text-align:left">Ha Noi</td>
</tr>
<tr>
<td style="text-align:left">01</td>
<td style="text-align:right">1000094</td>
<td style="text-align:right">3.8</td>
<td style="text-align:right">7.00</td>
<td style="text-align:right">4.2</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">3.75</td>
<td style="text-align:right">7.25</td>
<td style="text-align:right">7.50</td>
<td style="text-align:left">Ha Noi</td>
</tr>
<tr>
<td style="text-align:left">01</td>
<td style="text-align:right">1000093</td>
<td style="text-align:right">9.4</td>
<td style="text-align:right">7.50</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">8.50</td>
<td style="text-align:right">5.5</td>
<td style="text-align:right">6.75</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:left">Ha Noi</td>
</tr>
<tr>
<td style="text-align:left">01</td>
<td style="text-align:right">1000092</td>
<td style="text-align:right">6.2</td>
<td style="text-align:right">7.75</td>
<td style="text-align:right">4.0</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">3.75</td>
<td style="text-align:right">8.00</td>
<td style="text-align:right">8.25</td>
<td style="text-align:left">Ha Noi</td>
</tr>
<tr>
<td style="text-align:left">01</td>
<td style="text-align:right">1000091</td>
<td style="text-align:right">6.0</td>
<td style="text-align:right">6.50</td>
<td style="text-align:right">3.8</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">4.50</td>
<td style="text-align:right">6.00</td>
<td style="text-align:right">8.00</td>
<td style="text-align:left">Ha Noi</td>
</tr>
<tr>
<td style="text-align:left">01</td>
<td style="text-align:right">1000090</td>
<td style="text-align:right">8.4</td>
<td style="text-align:right">8.00</td>
<td style="text-align:right">9.2</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">NA</td>
<td style="text-align:right">6.25</td>
<td style="text-align:right">8.50</td>
<td style="text-align:right">8.50</td>
<td style="text-align:left">Ha Noi</td>
</tr>
</tbody>
</table>


  </div>
  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://haivo.netlify.app/tags/api/">API</a></li>
      <li><a href="https://haivo.netlify.app/tags/httr/">httr</a></li>
    </ul>
  </footer>
</article>
    </main>
    <footer class="footer">
    <span>&copy; 2021 <a href="https://haivo.netlify.app">Hai&#39;s blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
